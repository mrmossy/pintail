services:
  n8n:
    ports:
      - "5678:5678"
    environment:
      # Override SSL settings for development (no SSL)
      - DB_POSTGRESDB_SSL_ENABLED=
      - DB_POSTGRESDB_SSL_REJECT_UNAUTHORIZED=

  budibase:
    ports:
      - "8080:80"

  chat-service:
    ports:
      - "3000:3000"

  postgres:
    image: postgres:17.7-alpine
    container_name: postgres
    restart: unless-stopped
    networks:
      - web
    environment:
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - POSTGRES_APP_DB=${POSTGRES_APP_DB}
      - POSTGRES_APP_USER=${POSTGRES_APP_USER}
      - POSTGRES_APP_PASSWORD=${POSTGRES_APP_PASSWORD}
      - POSTGRES_N8N_DB=${POSTGRES_N8N_DB}
      - POSTGRES_N8N_USER=${POSTGRES_N8N_USER}
      - POSTGRES_N8N_PASSWORD=${POSTGRES_N8N_PASSWORD}
    volumes:
      - ./init-databases.sh:/docker-entrypoint-initdb.d/01-init-databases.sh
      - postgres-data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

networks:
  web:
    driver: bridge

volumes:
  postgres-data:
